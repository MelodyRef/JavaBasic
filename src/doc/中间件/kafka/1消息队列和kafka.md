# 1.1消息队列

## 1.1.1定义

消息队列：用于**不同进程或线程间通信**，用来处理一系列的输入请求的具有**先进先出**特性的队列，消息队列采用**异步通信**机制，消息的发送者和接收者无需同时与消息队列进行数据交互，消息会一直保存在队列中直至被接收者读取。

## 1.1.2作用

- 应用解耦：多个应用可通过消息队列对相同消息进行处理，应用间互相独立，互不影响
- 异步处理：相比于串行和并行处理，可以减少处理的时间
- 数据限流：流量高峰期，可通过消息队列控制流量
- 消息通信：实现点对点消息队列或者聊天室



# 1.2Kafka基本概念



## 1.2.1代理、生产者、消费者、消费者组



**代理（broker）**：kafka集群中，一个kafka进程（Kafka进程又称为Kafka实例）被称为一个代理（Broker)节点。

**生产者（Producer）**：生产者将消息发送到Kafka集群指定的主题topic中进行存储，同时生产者也能通过自定义算法决定将消息发送到哪个分区partition中

**消费者（consumer)**：消费者从Kafka集群指定的主题topic读取消息记录。在读取topic数据时，需要设置消费组名(groupId)，如果没有设置Kafka消费者会默认生成一个groupId

**消费者组（consumer group）**：消费者程序在读取Kafka系统topic中的数据时，通常使用多线程来执行，一个消费者组可以包含一个或多个消费者程序

> 一般而言一个消费者对应一个线程
>
> 在给应用程序设置线程数量时，遵循“线程数小于分区数”原则，如果线程数大于分区数，多余的线程不会消费分区中的数据，会造成资源浪费





## 1.2.2主题、分区、副本、记录



**主题（topic）**

Kafka系统通过主题topic来区分不同业务类型的消息记录



**分区（partition）**

每一个topic中可以有一个或多个分区，分区是基于物理层面上的，不同的分区对应着不同的数据文件

每个分区内部的消息记录是有序的，每个消息都有一个连续的偏移量序号offset

一个分区只对应一个broker,但是一个broker可以对应多个分区

**副本（replication）**

Kafka系统中，每个topic在创建时会要求指定副本数，默认是1，通过副本机制来保证Kafka分布式集群数据的可用性

> 创建topic时，主题的副本数设置规则如下：
>
> 1. 集群数量大于等于3，topic副本数量可以设置为3
> 2. 集群数量小于3，topic副本数量可以设置为1或者2



**记录（Record）**

被实际写入到Kafka集群并且可以被消费者应用程序读取的数据，称为记录（record）。每条记录包含一个key,value,和时间戳



# 1.2.3Kafka工作机制

